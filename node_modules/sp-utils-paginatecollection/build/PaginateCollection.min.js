(function(){var a;a=function(a,b){var c,d;return d=a.Model.extend({initialize:function(){return this.listenTo(this,"change:page",this.onChangePage),this.listenTo(this,"change:params",this.onChangeParams),this.listenTo(this,"change:page",this.onUpdateNextPrev),this.listenTo(this,"change:pages",this.onUpdateNextPrev),this.listenTo(this,"change:total",this.onUpdatePages),this.listenTo(this,"change:pagesize",this.onUpdatePages),this.listenTo(this,"change:page",this.onUpdateOffset),this.listenTo(this,"change:pagesize",this.onUpdateOffset),this.refreshMode=!0},defaults:{sync:!1,itemscount:0,page:0,pagesize:10,total:0,params:{},offset:0,pages:0,has_next:!0,has_prev:!1,_needReset:!1},setPage:function(a){var b,c;return this.refreshMode=!1,b=this.get("page"),c=this.get("_needReset")||1!==Math.abs(b-a),this.set({page:a,_needReset:c}),this.refreshMode=!0,this.refresh()},refresh:function(a,b){return null==a&&(a={}),null==b&&(b="impl_refresh"),this.refreshMode?this.collection[b](this,a).done(function(a){return function(b){var c;return c=a.collection.impl_parse_paginate(b,a),a.set(a.parse(c)),a.collection.fillData(b)}}(this)):void 0},updateParams:function(a,c){var d;return d=b.clone(this.get("params")),b.extend(d,a),this.set({params:d},c)},onChangePage:function(){return this.refresh()},onChangeParams:function(){return this.refreshMode=!1,this.set({page:0,_needReset:!0}),this.refreshMode=!0,this.refresh()},onUpdateOffset:function(a){var b;if(null==a.changed.offset)return b=a.get("page")*a.get("pagesize"),a.set({offset:b})},onUpdateNextPrev:function(a){var b,c,d,e;if(null==a.changed.has_next&&null==a.changed.has_prev)return d=a.get("page"),e=a.get("pages"),b=d>=0&&e>d+1,c=d>0&&e>d,a.set({has_next:b,has_prev:c})},onUpdatePages:function(a){var b;if(null==a.changed.pages)return b=Math.ceil(1*a.get("total")/a.get("pagesize")),a.set({pages:b},{silent:!0})},parse:function(a){var c;return c=b.chain(this).result("defaults").keys().value(),b.pick(a,c)}}),c=a.Collection.extend({constructor:function(){return this.meta=new d,this.meta.collection=this,a.Collection.prototype.constructor.apply(this,arguments)},impl_refresh:function(){throw new Error("PaginateCollection::impl_refresh need to implement")},impl_parse_paginate:function(){throw new Error("PaginateCollection::impl_parse_paginate need to implement")},set:function(b,c){return a.Collection.prototype.set.apply(this,arguments),this.trigger("set",b,c)},fillData:function(a){return this.meta.get("_needReset")&&(this.remove(this.models),this.meta.set({_needReset:!1})),this.add(a,{parse:!0}),this.meta.set({itemscount:this.size(),sync:!0})},initMeta:function(a){return this.meta.set(this.meta.parse(a),{silent:!0}),this},setPage:function(a,b){return null==b&&(b=!1),0>a||!b&&a===this.get("page")?$.Deferred().reject(!1):this.meta.setPage(a)},updateParams:function(a){return this.meta.updateParams(a)},pageBy:function(a,b){var c;return null==a&&(a=1),null==b&&(b=!1),c=this.meta.get("page")+a,0>c||c>=this.meta.get("pages")?$.Deferred().reject(!1):this.setPage(c,b)}}),c.version="0.0.3",c},"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(["backbone","underscore"],function(b,c){return a(b,c)}):window.PaginateCollection=a(Backbone,_)}).call(this);